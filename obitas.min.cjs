/*!
 * @odonata3d/obitas v0.1.0
 * 	copyright(c) 2024, odonata admin
 * 	https://odonata.xyz/
 * 	@license MIT
 */var W={};W.d=(r,t)=>{for(var e in t)W.o(t,e)&&!W.o(r,e)&&Object.defineProperty(r,e,{enumerable:!0,get:t[e]})},W.o=(r,t)=>Object.prototype.hasOwnProperty.call(r,t);var K={};W.d(K,{b:()=>y,h:()=>nt,n:()=>a});const v=Array.isArray,B=Array.from,lt=requestAnimationFrame,x=(r,t,e)=>r.setAttribute(t,e),D=(r,t)=>r.removeAttribute(t),I="string",at="number",U="object",X="function",tt="class",et="id",G="style",dt="text/css",b=()=>Object.create(null);function E(r){return r instanceof Element}function pt(r){return r instanceof Promise}const st="obt-",it=Symbol("D"),p=["created","destroyed","selected","checked"],_t={xlinkHref:"xlink:href"},rt=3,nt=(r,t,...e)=>{const i=typeof t=="object"&&!y.is(t)&&!v(t),s=(n,c=[])=>{if(v(n))for(const h of n)s(h,c);else if(y.is(n))c.push(n);else if(n!=null){const h=new y(null,b(),[]);h[w]=n,c.push(h)}return c};return new y(r,i?t:b(),s(i?e:[t,...e]))};function ot(r){return typeof r===I&&r.startsWith("on")}function mt(r,t,e=b()){r=r||b(),t=t||b();const i={...r,...t,...e};for(const s of a.mergeProps)(r[s]!=null||t[s]!=null||e[s]!=null)&&(i[s]=[r[s],t[s],e[s]]);return i}function ct(r,t){pt(r)?r.then(t):t(r)}function yt(r){let t=r.slice(2);return t.includes("-")&&(t=t.substring(0,t.indexOf("-"))),{key:t,opt:{capture:r.includes("-capture"),passive:r.includes("-passive"),once:r.includes("-once")}}}const gt={set:(r,t,e)=>{const i=r[t];return r[t]=e,i!==e&&r[it]?.deref()?.dispatch(),!0}},w=Symbol("c"),_=Symbol("d"),A=Symbol("k"),Y=Symbol("r"),F=Symbol("p"),Z=Symbol("f"),H=Symbol("h"),S=Symbol("t"),N=Symbol("s"),d=Symbol("e"),L=Symbol("b"),O=Symbol("f");class y{tag;real;allProps;props;states;children;slots;methods;computed;refs;[F];[w];[_];[A]=null;[Z];[L]=!1;[H];[S];[d]={$:[]};[N]=0;get[O](){return this[H]||this[F]}constructor(t,e,i){this.tag=typeof t=="string"&&a.components[t]||t,this.allProps=e||b(),this[A]=e?.key,this.slots=[...i],this.children=i;const s=(n,c)=>new Proxy(b(),{get:(h,C)=>{let m=this;for(;m;){var o=m.tag;if(a.is(o)){const u=o.options[n];if(u&&typeof u[C]===X)return c(m,u[C])}m=m[S]}}});this.methods=s("methods",(n,c)=>(...h)=>c.apply(n,h)),this.computed=s("computed",(n,c)=>c.apply(n))}static is(t){return t instanceof y}get head(){let t=this;for(;t[H];)t=t[H];return t}get tail(){let t=this;for(;t[S];)t=t[S];return t}get[Y](){let t=this;do if(a.is(t?.tag))break;while(t=t[O]);return t}extract({real:t,callback:e,pre:i}){const s=this.tag,n=this.allProps;this.refs=b(),i&&(i[L]=!1,this[d].destroyed=i[d].destroyed,this[N]=i[N]);var c=a.is(s),h=y.is(s);if(!c&&!h){this[_]=n;let o=this;for(;o[O]&&!o[_]?.xmlns;)o=o[O];const u=o?.[_]?.xmlns||o?.real?.namespaceURI,f=(()=>{if(E(s))return s;if(E(this[w]))return this[w];if(!s&&t?.nodeType===rt){const l=ht(this[w]);return l!==t.textContent&&(t.textContent=l),t}return t?.nodeName?.toLowerCase()===s?t:typeof s=="string"?typeof u=="string"?window.document.createElementNS(u,s):window.document.createElement(s):window.document.createTextNode(ht(this[w]))})();if(this.real=f,e(f),E(f)){let l=this;for(;l=l[O];)if(a.is(l.tag)&&(x(f,l.tag.id,""),l.real!=f))return}return}this[_]=b(),this.props=b();const C=i?.[S],m=o=>{if(this[S]=o,!o)return e();o[H]=this,o.extract({real:t,callback:u=>{this.real=u,this[_]=o[_]=mt(this[_],o[_]),this.children=o.children,this.refs=o.refs,e(u)},pre:o.tag===C?.tag?C:void 0})};for(const o in n){const u=n[o];if(c&&s.options.props?.includes(o)){ot(o)&&typeof u=="function"?this.on(o.substring(2),u):this.props[o]=u;continue}this[_][o]=u}if(h)return m(s);ct(i?.states||s.options.states?.call(this),o=>{o?(this.states=i?.states===o?o:new Proxy(o,gt),this.states[it]=new WeakRef(this)):delete this.states,ct(s.render(this,nt),m)})}off(t,e){this[d][t]&&this[d][t].includes(e)&&this[d][t].splice(this[d][t].indexOf(e),1)}on(t,e,i=!1){if(typeof e!==X)return;const s=this[d][t]=this[d][t]||[];if(t===p[0]&&this[N]>0&&!i){s.includes(e)||(e(this),s.push(e));return}else{if(t===p[1]&&this[N]>1&&!i)return;s.includes(e)||s.push(e)}}emit(t,...e){const i=this[d][t];if(i)for(const s of i)s.call(this,...e)}dispatch(t){const e=this[Y];t&&e[d].$.push(t),e[L]=!0,lt(()=>{if(!e[L]||e.tail!==e.real?.$?.tail||e.real?.isConnected===!1)return;let i=e;for(;i=i[O];)if(i[L])return;e.real.$=this,e.patch(e.real)})}disconnect(){for(const e of this.children)e.disconnect();let t=this;for(;t[O];)t=t[O];this._destroy(),t.real?.remove()}_patch({newElm:t,oldVDom:e},i){if(!t||(t.$=this.head,t.nodeType===rt))return i(t);const s=e?.[_]||b(),n=this[_],c={...s,...n};for(const f in c)this.attr(t,f,n[f],s[f]);const h=B(t.childNodes),C=B(h),m=this.children,o=new WeakMap;this.tag==="option"&&this[F]?.tag==="select"&&(this[F][_].value===this[_].value?x(t,p[2],""):D(t,p[2]));const u=(f,l)=>{const $=m[f];if(!$)return;const g=m[f-1],P=m[f+1];let M=l,k=0,q=[];for(let T=l;T<h.length;++T){const J=h[T-1],V=h[T],ut=h[T+1];let j=z(g,J?.$,0,1)+z($,V?.$)+z(P,ut?.$,0,1);if(j=Number.isNaN(j)?-1:j,j>k){if(M=T,q.push({sim:j,vdom:V.$}),j===1/0)break;k=j}}let R=q[q.length-1];if(R&&R.sim!==1/0&&M<h.length&&P){const T=z(P,h[M]?.$),J=u(f+1,M+1);J&&J.vdom==null&&T>=R.sim&&(R=q[q.length-2])}else u(f+1,M+1);return R&&o.set($,R.vdom),R};if(!E(this.tag)&&typeof n.html!==I){u(0,0);let f,l=a.is(this.tag)?this:this[Y];for(;l[S]&&a.is(l[S].tag);)l=l[S];for(const $ of m){$[F]=this.tail;const g=o.get($);$.patch(g?.real,P=>{P&&(g?(C.splice(C.indexOf(g.real),1),P!==g.real&&g.real.replaceWith(P)):f?f.after(P):t.prepend(P),f=P)})}for(const $ of C){const g=$.$;(!g||g[Z]!==!0)&&(g?._destroy(),$.remove())}}this[d].$.forEach(f=>f()),this[d].$=[],e||this._create(),i(t),this[L]=!1}create(t){this.patch(void 0,t)}patch(t,e){const i=t?.$;this.extract({real:t,pre:i,callback:s=>this._patch({newElm:s,oldVDom:i},typeof e=="function"?e:()=>{})})}attr(t,e,i,s){if(a.directives[e]){a.directives[e](this,t,e,i,s);return}if(e=_t[e]||e,ot(e)){let{key:n,opt:c}=yt(e);s&&t.removeEventListener(n,s),i&&(t.removeEventListener(n,i),t.addEventListener(n,i,c))}else i!=null?typeof i===U?t[e]=i:x(t,e,i===!0?"":i):D(t,e)}_create(){this[N]>0||(a.is(this.tag)&&this.tag.options?.created?.call(this),this.emit(p[0],this),delete this[d].created,this[S]?._create(),this[N]=1)}_destroy(){if(this[N]==1){this[N]=2;for(const t of this.children)t._destroy();this.emit(p[1],this),delete this[d].destroyed,a.is(this.tag)&&this.tag.options?.destroyed?.call(this),this[S]?._destroy()}}}function z(r,t,e=-1/0,i=1/0){return!r||!t?e:r[A]!=null&&t[A]!=null?r[A]===t[A]?i:e:r===t||r.real===t.real?i:r.tag===t.tag?r[w]&&r[w]===t[w]||typeof r[w]===I&&typeof t[w]===I||E(r.tag)?i:1:y.is(r.tag)&&y.is(t.tag)?z(r.tag,t.tag,e,i):e}function ft(r,t=""){if(v(r))for(const e of r)t+=ft(e);else if(typeof r===U)for(const e in r)r[e]!=null&&(t+=`${e}:${r[e]};`);else r&&(t+=r);return t}function Q(r,t=new Set){if(v(r))for(const e of r)Q(e,t);else if(typeof r===U)for(const e in r)r[e]&&t.add(e);else r&&t.add(r);return B(t).join(" ")}function ht(r){return[I,U,at,X].includes(typeof r)?r.toString():JSON.stringify(r)}class a{static is(t){return t instanceof a}id;constructor(t){this.options=t;const e=this.id=st+(Math.random()+1).toString(36).substring(5);if(typeof t.name===I&&(a.components[t.name]=this),t.style){const i=window.document.createElement(G);x(i,st+"style",""),x(i,"type",dt),i.appendChild(window.document.createTextNode(t.style)),window.document.head.appendChild(i),x(i,e,"");const s=n=>{if(n instanceof CSSStyleRule){n.selectorText=n.selectorText.replace(/(?<!:[-a-zA-Z0-9]*)[^>*+\s,:]+(?<!\\\\)(?=,|\s+|:|$)/gm,c=>`${c}[${e}]`).replace(/\\\\/gm,"");return}if(v(n.cssRules))for(const c of n.cssRules)s(c)};for(const n of i.sheet.cssRules)s(n)}}options;create(t,...e){return new y(this,t,e)}render(t,e){return this.options.render.call(t,e)}connect(t,e,...i){const s=typeof t===I?window.document.querySelector(t):t;if(!s)throw new Error("invalid element.");const n=new y(this,e,i);return n.patch(s),n}static mergeProps=new Set([tt,et,G]);static components={};static directives={html(t,e,i,s,n){n!==s&&(e.innerHTML=s)},ref(t,e,i,s){const n=t[O]?.[Y];if(n)return v(n.refs[s])?n.refs[s].push(t):n.refs[s]?n.refs[s]=[n.refs[s],t]:n.refs[s]=t},key(t,e,i,s){s?t[A]=s:delete t[A]},style(t,e,i,s){const n=ft(s);n?x(e,G,n):D(e,i)},id(t,e,i,s){const n=Q(s);n?x(e,et,n):D(e,i)},class(t,e,i,s){const n=Q(s);n?x(e,tt,n):D(e,i)},checked(t,e,i,s){s?x(e,p[3],""):D(e,p[3])},float(t,e,i,s){typeof s=="boolean"?t[Z]=s:t[Z]=!1},hook(t,e,i,s){s=v(s)?s:[s];for(const n of s)typeof n===X&&n(t)},ondestroyed(t,e,i,s,n){n&&t.off(p[1],n),t.off(p[1],s),t.on(p[1],s,!0)},oncreated(t,e,i,s,n){n&&t.off(p[0],n),t.off(p[0],s),t.on(p[0],s,!0)}}}var bt=K.n,wt=K.b,St=K.h;export{bt as Obitas,wt as ObitasDOM,St as h};
