/*!
 * @odonata3d/obitas v0.1.0
 * 	copyright(c) 2024, odonata admin
 * 	https://odonata.xyz/
 * 	@license MIT
 */var g={};g.d=(i,t)=>{for(var e in t)g.o(t,e)&&!g.o(i,e)&&Object.defineProperty(i,e,{enumerable:!0,get:t[e]})},g.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),g.o=(i,t)=>Object.prototype.hasOwnProperty.call(i,t);var J={};g.d(J,{b:()=>y,h:()=>st,n:()=>d});const v=Array.isArray,Z=Array.from,ht=requestAnimationFrame,N=(i,t,e)=>i.setAttribute(t,e),q=(i,t)=>i.removeAttribute(t),I="string",at="number",K="object",U="function",k="class",B="style",ut="text/css",w=()=>Object.create(null);function F(i){return i instanceof Element}function lt(i){return i instanceof Promise}const V="obt-",tt=Symbol("D"),p=["created","destroyed","selected","checked"],dt={xlinkHref:"xlink:href"},et=3,st=(i,t,...e)=>{const r=typeof t=="object"&&!y.is(t)&&!v(t),s=(n,c=[])=>{if(v(n))for(const h of n)s(h,c);else if(y.is(n))c.push(n);else if(n!=null){const h=new y(null,w(),[]);h[S]=n,c.push(h)}return c};return new y(i,r?t:w(),s(r?e:[t,...e]))};function rt(i){return typeof i===I&&i.startsWith("on")}function pt(i,t,e=w()){i=i||w(),t=t||w();const r={...i,...t,...e};for(const s of d.mergeProps)(i[s]!=null||t[s]!=null||e[s]!=null)&&(r[s]=[i[s],t[s],e[s]]);return r}function it(i,t){lt(i)?i.then(t):t(i)}function _t(i){let t=i.slice(2);return t.includes("-")&&(t=t.substring(0,t.indexOf("-"))),{key:t,opt:{capture:i.includes("-capture"),passive:i.includes("-passive"),once:i.includes("-once")}}}const mt={set:(i,t,e)=>{const r=i[t];return i[t]=e,r!==e&&i[tt]?.deref()?.dispatch(),!0}},S=Symbol("c"),_=Symbol("d"),j=Symbol("k"),X=Symbol("r"),W=Symbol("p"),Y=Symbol("f"),E=Symbol("h"),$=Symbol("t"),O=Symbol("s"),l=Symbol("e"),D=Symbol("b");class y{tag;real;allProps;props;data;children;slots;methods;computed;refs;[W];[S];[_];[j]=null;[Y];[D]=!1;[E];[$];[l]={$:[]};[O]=0;constructor(t,e,r){this.tag=typeof t=="string"&&d.components[t]||t,this.allProps=e||w(),this[j]=e?.key,this.slots=[...r],this.children=r;const s=(n,c)=>new Proxy(w(),{get:(h,C)=>{let m=this;for(;m;){var o=m.tag;if(d.is(o)){const a=o.options[n];if(a&&typeof a[C]===U)return c(m,a[C])}m=m[$]}}});this.methods=s("methods",(n,c)=>(...h)=>c.apply(n,h)),this.computed=s("computed",(n,c)=>c.apply(n))}static is(t){return t instanceof y}get forward(){return this[E]||this[W]}get head(){let t=this;for(;t[E];)t=t[E];return t}get tail(){let t=this;for(;t[$];)t=t[$];return t}get[X](){let t=this;do if(d.is(t?.tag))break;while(t=t.forward);return t}extract({real:t,callback:e,pre:r}){const s=this.tag,n=this.allProps;this.refs=w(),r&&(r[D]=!1,this[l].destroyed=r[l].destroyed,this[O]=r[O]);var c=d.is(s),h=y.is(s);if(!c&&!h){this[_]=n;let o=this;for(;o.forward&&!o[_]?.xmlns;)o=o.forward;const a=o?.[_]?.xmlns||o?.real?.namespaceURI,f=(()=>{if(F(s))return s;if(F(this[S]))return this[S];if(!s&&t?.nodeType===et){const u=ct(this[S]);return u!==t.textContent&&(t.textContent=u),t}return t?.nodeName?.toLowerCase()===s?t:typeof s=="string"?typeof a=="string"?g.g.document.createElementNS(a,s):g.g.document.createElement(s):g.g.document.createTextNode(ct(this[S]))})();if(this.real=f,e(f),F(f)){let u=this;for(;u=u.forward;)if(d.is(u.tag)&&(N(f,u.tag.id,""),u.real!=f))return}return}this[_]=w(),this.props=w();const C=r?.[$],m=o=>{if(this[$]=o,!o)return e();o[E]=this,o.extract({real:t,callback:a=>{this.real=a,this[_]=o[_]=pt(this[_],o[_]),this.children=o.children,this.refs=o.refs,e(a)},pre:o.tag===C?.tag?C:void 0})};for(const o in n){const a=n[o];if(c&&s.options.props?.includes(o)){rt(o)&&typeof a=="function"?this.on(o.substring(2),a):this.props[o]=a;continue}this[_][o]=a}if(h)return m(s);it(r?.data||s.options.data?.call(this),o=>{o?(this.data=r?.data===o?o:new Proxy(o,mt),this.data[tt]=new WeakRef(this)):delete this.data,it(s.render(this,st),m)})}off(t,e){this[l][t]&&this[l][t].includes(e)&&this[l][t].splice(this[l][t].indexOf(e),1)}on(t,e,r=!1){if(typeof e!==U)return;const s=this[l][t]=this[l][t]||[];if(t===p[0]&&this[O]>0&&!r){s.includes(e)||(e(this),s.push(e));return}else{if(t===p[1]&&this[O]>1&&!r)return;s.includes(e)||s.push(e)}}emit(t,...e){const r=this[l][t];if(r)for(const s of r)s.call(this,...e)}dispatch(t){const e=this[X];t&&e[l].$.push(t),e[D]=!0,ht(()=>{if(!e[D]||e.tail!==e.real?.$?.tail||e.real?.isConnected===!1)return;let r=e;for(;r=r.forward;)if(r[D])return;e.real.$=this,e.patch(e.real)})}disconnect(){for(const e of this.children)e.disconnect();let t=this;for(;t.forward;)t=t.forward;this._destroy(),t.real?.remove()}_patch({newElm:t,oldVDom:e},r){if(!t||(t.$=this.head,t.nodeType===et))return r(t);const s=e?.[_]||w(),n=this[_],c={...s,...n};for(const f in c)this.attr(t,f,n[f],s[f]);const h=Z(t.childNodes),C=Z(h),m=this.children,o=new WeakMap;this.tag==="option"&&this[W]?.tag==="select"&&(this[W][_].value===this[_].value?N(t,p[2],""):q(t,p[2]));const a=(f,u)=>{const P=m[f];if(!P)return;const b=m[f-1],x=m[f+1];let L=u,G=0,M=[];for(let T=u;T<h.length;++T){const z=h[T-1],Q=h[T],ft=h[T+1];let R=H(b,z?.$,0,1)+H(P,Q?.$)+H(x,ft?.$,0,1);if(R=Number.isNaN(R)?-1:R,R>G){if(L=T,M.push({sim:R,vdom:Q.$}),R===1/0)break;G=R}}let A=M[M.length-1];if(A&&A.sim!==1/0&&L<h.length&&x){const T=H(x,h[L]?.$),z=a(f+1,L+1);z&&z.vdom==null&&T>=A.sim&&(A=M[M.length-2])}else a(f+1,L+1);return A&&o.set(P,A.vdom),A};if(!F(this.tag)&&typeof n.html!==I){a(0,0);let f,u=d.is(this.tag)?this:this[X];for(;u[$]&&d.is(u[$].tag);)u=u[$];for(const P of m){P[W]=this.tail;const b=o.get(P);P.patch(b?.real,x=>{x&&(b?(C.splice(C.indexOf(b.real),1),x!==b.real&&b.real.replaceWith(x)):f?f.after(x):t.prepend(x),f=x)})}for(const P of C){const b=P.$;(!b||b[Y]!==!0)&&(b?._destroy(),P.remove())}}this[l].$.forEach(f=>f()),this[l].$=[],e||this._create(),r(t),this[D]=!1}create(t){this.patch(void 0,t)}patch(t,e){const r=t?.$;this.extract({real:t,pre:r,callback:s=>this._patch({newElm:s,oldVDom:r},typeof e=="function"?e:()=>{})})}attr(t,e,r,s){if(d.directives[e]){d.directives[e](this,t,e,r,s);return}if(e=dt[e]||e,rt(e)){let{key:n,opt:c}=_t(e);s&&t.removeEventListener(n,s),r&&(t.removeEventListener(n,r),t.addEventListener(n,r,c))}else r!=null?typeof r===K?t[e]=r:N(t,e,r===!0?"":r):q(t,e)}_create(){this[O]>0||(d.is(this.tag)&&this.tag.options?.created?.call(this),this.emit(p[0],this),delete this[l].created,this[$]?._create(),this[O]=1)}_destroy(){if(this[O]==1){this[O]=2;for(const t of this.children)t._destroy();this.emit(p[1],this),delete this[l].destroyed,d.is(this.tag)&&this.tag.options?.destroyed?.call(this),this[$]?._destroy()}}}function H(i,t,e=-1/0,r=1/0){return!i||!t?e:i[j]!=null&&t[j]!=null?i[j]===t[j]?r:e:i===t||i.real===t.real?r:i.tag===t.tag?i[S]&&i[S]===t[S]||typeof i[S]===I&&typeof t[S]===I||F(i.tag)?r:1:y.is(i.tag)&&y.is(t.tag)?H(i.tag,t.tag,e,r):e}function nt(i,t=""){if(v(i))for(const e of i)t+=nt(e);else if(typeof i===K)for(const e in i)i[e]!=null&&(t+=`${e}:${i[e]};`);else i&&(t+=i);return t}function ot(i,t=new Set){if(v(i))for(const e of i)ot(e,t);else if(typeof i===K)for(const e in i)i[e]&&t.add(e);else i&&t.add(i);return Z(t).join(" ")}function ct(i){return[I,K,at,U].includes(typeof i)?i.toString():JSON.stringify(i)}class d{static is(t){return t instanceof d}id;constructor(t){this.options=t;const e=this.id=V+(Math.random()+1).toString(36).substring(5);if(t.style){const r=g.g.document.createElement(B);N(r,V+"style",""),N(r,"type",ut),r.appendChild(g.g.document.createTextNode(t.style)),g.g.document.head.appendChild(r),N(r,e,"");const s=n=>{if(n instanceof CSSStyleRule){n.selectorText=n.selectorText.replace(/(?<!:[-a-zA-Z0-9]*)[^>*+\s,:]+(?<!\\\\)(?=,|\s+|:|$)/gm,c=>`${c}[${e}]`).replace(/\\\\/gm,"");return}if(v(n.cssRules))for(const c of n.cssRules)s(c)};for(const n of r.sheet.cssRules)s(n)}}options;create(t,...e){return new y(this,t,e)}render(t,e){return this.options.render.call(t,e)}connect(t,e,...r){const s=typeof t===I?g.g.document.querySelector(t):t;if(!s)throw new Error("invalid element.");const n=new y(this,e,r);return n.patch(s),n}static mergeProps=new Set([k,B]);static components={};static directives={html(t,e,r,s,n){n!==s&&(e.innerHTML=s)},ref(t,e,r,s){const n=t[X];return v(n.refs[s])?n.refs[s].push(t):n.refs[s]?n.refs[s]=[n.refs[s],t]:n.refs[s]=t},key(t,e,r,s){s?t[j]=s:delete t[j]},style(t,e,r,s){const n=nt(s);n?N(e,B,n):q(e,r)},class(t,e,r,s){const n=ot(s);n?N(e,k,n):q(e,r)},checked(t,e,r,s){s?N(e,p[3],""):q(e,p[3])},float(t,e,r,s){typeof s=="boolean"?t[Y]=s:t[Y]=!1},hook(t,e,r,s){s=v(s)?s:[s];for(const n of s)typeof n===U&&n(t)},ondestroyed(t,e,r,s,n){n&&t.off(p[1],n),t.off(p[1],s),t.on(p[1],s,!0)},oncreated(t,e,r,s,n){n&&t.off(p[0],n),t.off(p[0],s),t.on(p[0],s,!0)}}}var gt=J.n,yt=J.b,bt=J.h;export{gt as Obitas,yt as ObitasDOM,bt as h};
